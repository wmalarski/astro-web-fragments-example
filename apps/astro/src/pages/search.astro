---
import { SearchList } from "../components/infinite-lists/search-list";
import MediaCardList from "../components/media-card-list.astro";
import { getTMDBContext, search } from "../integrations/tmdb/services";
import Layout from "../layouts/layout.astro";

export const prerender = false;

const getData = async () => {
  const url = new URL(Astro.request.url);

  const query = url.searchParams.get("query");

  if (!query) {
    return { result: null };
  }

  const context = getTMDBContext();
  const result = await search({ context, page: 1, query });

  return { query, result };
};

const { query, result } = await getData();
---

<Layout>
  <SearchList query={query} pageCount={result?.total_pages}>
    <MediaCardList collection={result?.results ?? []} />
  </SearchList>
</Layout>
